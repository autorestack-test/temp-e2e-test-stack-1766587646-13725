name: Update Stacked PRs on Squash Merge (E2E Test)
on:
  pull_request:
    types: [closed]
permissions:
  contents: write
  pull-requests: write
jobs:
  update-pr-stack:
    # Only run on actual squash merges initiated by the test script
    if: |
      github.event.pull_request.merged == true &&
      github.event.pull_request.merge_commit_sha != ''
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Fetch all history for all branches and tags
          fetch-depth: 0
          # Use a PAT token for checkout to allow pushing updates
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Update PR stack
        # Use the action from the current repository checkout
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
